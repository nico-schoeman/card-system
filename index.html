<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<title>Cards</title>
		<script type="module" src="./index.js"></script>
	</head>
	<body>
		<script type="module">
			import { html, render } from 'lit-html/lit-html.js';
			import { CardStore } from './index.js';
			import DataStore from '@nico-schoeman/data-store';
			import CardFactory from './card.factory.js';

			const store = new DataStore();

			let cardStore = new CardStore();
			let tokenStore = new DataStore();

      store.set('cards', cardStore);
			store.set('tokens', tokenStore);

      let factory = new CardFactory();

      factory.addAction('drawUntil', (context) => {
        console.log('drawUntil');
        cardStore.drawUntil(context.card.stats.draw);
      }, 'DRAW until you have [draw] cards.');

      factory.addCheck('cardsLessThan', (context) => {
        console.log('cardsLessThan');
        if (cardStore.selectHand().length < context.card.stats.drawmin) return true;
        return false;
      }, 'if you have less than [drawmin] cards');

      factory.addTip('DRAW', 'draw a card from your draw pile', 'RED');

			for (let index = 0; index < 30; index++) {
				let card = factory.BasicCard();
        card.stats.draw = 5;
        card.stats.drawmin = 3;
        factory.addCardAction(card, 'drawUntil', 'cardsLessThan');
        console.log(card);
				cs.addCardToDeck(card);
			}

			cardStore.setDraw();
			cardStore.shuffleDraw();
			cardStore.drawUntil(5);
			cardStore.discardFromHandRandom(1);

			tokenStore.set('tokens', [{}, {}]);

			export class Test extends HTMLElement {
				connectedCallback() {
					render(
						html`
							<c-deck id="draw-pile"></c-deck>
							<c-stage .store=${tokenStore}></c-stage>
							<c-hand .store=${cs}></c-hand>
							<c-discard id="discard-pile"></c-discard>
						`,
						this,
					);
				}
			}
			if (!customElements.get('c-test')) {
				customElements.define('c-test', Test);
			}
		</script>
		<c-test></c-test>
	</body>
</html>
